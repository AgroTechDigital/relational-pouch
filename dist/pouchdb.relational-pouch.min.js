!function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=n[u]={exports:{}};t[u][0].call(a.exports,function(e){var n=t[u][1][e];return o(n?n:e)},a,a.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){"use strict";function r(){this.store={}}function o(){this.store=new r}n.Map=r,n.Set=o,r.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},r.prototype.unmangle=function(e){return e.substring(1)},r.prototype.get=function(e){var t=this.mangle(e);return t in this.store?this.store[t]:void 0},r.prototype.set=function(e,t){var n=this.mangle(e);return this.store[n]=t,!0},r.prototype.has=function(e){var t=this.mangle(e);return t in this.store},r.prototype["delete"]=function(e){var t=this.mangle(e);return t in this.store?(delete this.store[t],!0):!1},r.prototype.forEach=function(e){var t=this,n=Object.keys(t.store);n.forEach(function(n){var r=t.store[n];n=t.unmangle(n),e(r,n)})},o.prototype.add=function(e){return this.store.set(e,!0)},o.prototype.has=function(e){return this.store.has(e)},o.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],2:[function(e,t,n){"use strict";function r(e){var t=new Error(e);return t.status=400,t}function o(e,t){var n=e.replace("_","")+"_";if("number"==typeof t){for(t=t.toString();t.length<l;)t="0"+t;n+=d+"_"+t}else n+="undefined"==typeof t?p:"object"==typeof t?v:h+"_"+t;return n}function i(e){var t=e.indexOf("_"),n=e.charAt(t+1),r=e.substring(t+3);return n===d?parseInt(r,10):r}var u=e("./../pouch-utils"),s=u.extend,c=u.Promise,a=e("./collections"),f=e("./uuid"),l=16,p="0",d="1",h="2",v="3";n.setSchema=function(e){function t(e,t){t=s(!0,{},t);var n={};t.rev&&(n._rev=t.rev,delete t.rev);var r=t.id||f();return delete t.id,n._id=o(e.singular,r),e.relations&&Object.keys(e.relations).forEach(function(n){var r=e.relations[n],o=Object.keys(r)[0];if("belongsTo"===o)t[n]&&"undefined"!=typeof t[n].id&&(t[n]=t[n].id);else if(t[n]){var i=t[n].map(function(e){return e&&"undefined"!=typeof e.id?e.id:e});t[n]=i}else t[n]=[]}),n.data=t,n}function n(e,t){var n=t.data;return n.id=i(t._id),n.rev=t._rev,n}function u(e){if(!v.has(e))throw r("unknown type: "+JSON.stringify(e));return v.get(e)}function l(e,n){var r,o=u(e);return c.resolve().then(function(){return r=t(o,n),h.put(r)}).then(function(e){var t={};return t[o.plural]=[s(!0,n,{id:i(e.id),rev:e.rev})],t})}function p(e,n){var r,o=u(e);return c.resolve().then(function(){return r=t(o,n),r={_id:r._id,_rev:r._rev,_deleted:!0},h.put(r)}).then(function(){return{deleted:!0}})}function d(e,t,r){var i=u(e),f={include_docs:!0};return"undefined"==typeof t||null===t?(f.startkey=o(i.singular),f.endkey=o(i.singular,{})):Array.isArray(t)?f.keys=t.map(function(e){return o(i.singular,e)}):f.key=o(i.singular,t),r.has(e)||r.set(e,new a.Map),h.allDocs(f).then(function(t){var o=t.rows.filter(function(e){return e.doc&&!e.value.deleted}).map(function(t){var o=n(i,t.doc);r.get(e).set(JSON.stringify(o.id),o);var u=[];return Object.keys(i.relations||{}).forEach(function(e){var t=i.relations[e],n=Object.keys(t)[0],a=t[n];if("belongsTo"===n){var f=o[e];"undefined"!=typeof f&&u.push(c.resolve().then(function(){return r.has(a)&&r.get(a).has(JSON.stringify(f))?r.get(a).get(JSON.stringify(f)):d(a,f,r)}))}else{var l=s(!0,[],o[e]);"undefined"!=typeof l&&l.length&&u.push(c.resolve().then(function(){for(var e=l.length-1;e>=0;e--){var t=l[e];r.has(a)&&r.get(a).has(JSON.stringify(t))&&delete l[e]}return l=l.filter(function(e){return"undefined"!=typeof e}),l.length?d(a,l,r):void 0}))}}),c.all(u)});return c.all(o).then(function(){var e={};return r.forEach(function(t,n){var r=u(n),o=e[r.plural]=[];t.forEach(function(e){o.push(e)}),o.sort(function(e,t){return e.id<t.id?-1:1})}),e})})}var h=this,v=new a.Map;e.forEach(function(e){v.set(e.singular,e),v.set(e.plural,e)}),e.forEach(function(e){if(e.relations){if(!Object.keys(e.relations).length)throw new Error("Invalid relations for: "+e);Object.keys(e.relations).forEach(function(t){var n=e.relations[t];if(1!==Object.keys(n).length)throw new Error("Invalid relationship definition for: "+t);var r=Object.keys(n)[0],o=n[r];if(!v.get(o))throw new Error("Unknown entity type: "+o);if("belongsTo"!==r&&"hasMany"!==r)throw new Error("Invalid relationship type for "+t+": "+r)})}}),h.rel={save:function(e,t){return c.resolve().then(function(){return l(e,t)})},find:function(e,t){return c.resolve().then(function(){return d(e,t,new a.Map)})},del:function(e,t){return c.resolve().then(function(){return p(e,t)})}}},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{"./../pouch-utils":25,"./collections":1,"./uuid":3}],3:[function(e,t){"use strict";function n(e){return 0|Math.random()*e}function r(e,t){t=t||o.length;var r="",i=-1;if(e){for(;++i<e;)r+=o[n(t)];return r}for(;++i<36;)switch(i){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=o[3&n(16)|8];break;default:r+=o[n(16)]}return r}var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.exports=r},{}],4:[function(){},{}],5:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],7:[function(e,t){"use strict";function n(){}t.exports=n},{}],8:[function(e,t){"use strict";var n=e("./promise"),r=e("./reject"),o=e("./resolve"),i=e("./INTERNAL"),u=e("./handlers"),s=r(new TypeError("must be an array"));t.exports=function(e){function t(e,t){function n(e){a[t]=e,++f===r&!c&&(c=!0,u.resolve(p,a))}o(e).then(n,function(e){c||(c=!0,u.reject(p,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return s;var r=e.length,c=!1;if(!r)return o([]);for(var a=new Array(r),f=0,l=-1,p=new n(i);++l<r;)t(e[l],l);return p}},{"./INTERNAL":7,"./handlers":9,"./promise":11,"./reject":13,"./resolve":14}],9:[function(e,t,n){"use strict";function r(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var o=e("./tryCatch"),i=e("./resolveThenable"),u=e("./states");n.resolve=function(e,t){var s=o(r,t);if("error"===s.status)return n.reject(e,s.value);var c=s.value;if(c)i.safely(e,c);else{e.state=u.FULFILLED,e.outcome=t;for(var a=-1,f=e.queue.length;++a<f;)e.queue[a].callFulfilled(t)}return e},n.reject=function(e,t){e.state=u.REJECTED,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":15,"./states":16,"./tryCatch":17}],10:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all")},{"./all":8,"./promise":11,"./reject":13,"./resolve":14}],11:[function(e,t){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("reslover must be a function");this.state=u.PENDING,this.queue=[],this.outcome=void 0,e!==o&&i.safely(this,e)}var r=e("./unwrap"),o=e("./INTERNAL"),i=e("./resolveThenable"),u=e("./states"),s=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===u.FULFILLED||"function"!=typeof t&&this.state===u.REJECTED)return this;var i=new n(o);if(this.state!==u.PENDING){var c=this.state===u.FULFILLED?e:t;r(i,c,this.outcome)}else this.queue.push(new s(i,e,t));return i}},{"./INTERNAL":7,"./queueItem":12,"./resolveThenable":15,"./states":16,"./unwrap":18}],12:[function(e,t){"use strict";function n(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var r=e("./handlers"),o=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){o(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){r.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){o(this.promise,this.onRejected,e)}},{"./handlers":9,"./unwrap":18}],13:[function(e,t){"use strict";function n(e){var t=new r(o);return i.reject(t,e)}var r=e("./promise"),o=e("./INTERNAL"),i=e("./handlers");t.exports=n},{"./INTERNAL":7,"./handlers":9,"./promise":11}],14:[function(e,t){"use strict";function n(e){if(e)return e instanceof r?e:i.resolve(new r(o),e);var t=typeof e;switch(t){case"boolean":return u;case"undefined":return c;case"object":return s;case"number":return a;case"string":return f}}var r=e("./promise"),o=e("./INTERNAL"),i=e("./handlers");t.exports=n;var u=i.resolve(new r(o),!1),s=i.resolve(new r(o),null),c=i.resolve(new r(o),void 0),a=i.resolve(new r(o),0),f=i.resolve(new r(o),"")},{"./INTERNAL":7,"./handlers":9,"./promise":11}],15:[function(e,t,n){"use strict";function r(e,t){function n(t){s||(s=!0,o.reject(e,t))}function r(t){s||(s=!0,o.resolve(e,t))}function u(){t(r,n)}var s=!1,c=i(u);"error"===c.status&&n(c.value)}var o=e("./handlers"),i=e("./tryCatch");n.safely=r},{"./handlers":9,"./tryCatch":17}],16:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],17:[function(e,t){"use strict";function n(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}t.exports=n},{}],18:[function(e,t){"use strict";function n(e,t,n){r(function(){var r;try{r=t(n)}catch(i){return o.reject(e,i)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)})}var r=e("immediate"),o=e("./handlers");t.exports=n},{"./handlers":9,immediate:19}],19:[function(e,t){"use strict";function n(){o=!0;for(var e,t,n=s.length;n;){for(t=s,s=[],e=-1;++e<n;)t[e]();n=s.length}o=!1}function r(e){1!==s.push(e)||o||i()}for(var o,i,u=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],s=[],c=-1,a=u.length;++c<a;)if(u[c]&&u[c].test&&u[c].test()){i=u[c].install(n);break}t.exports=r},{"./messageChannel":20,"./mutation.js":21,"./nextTick":4,"./stateChange":22,"./timeout":23}],20:[function(e,t,n){var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};n.test=function(){return r.setImmediate?!1:"undefined"!=typeof r.MessageChannel},n.install=function(e){var t=new r.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}},{}],21:[function(e,t,n){var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},o=r.MutationObserver||r.WebKitMutationObserver;n.test=function(){return o},n.install=function(e){var t=0,n=new o(e),i=r.document.createTextNode("");return n.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}},{}],22:[function(e,t,n){var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};n.test=function(){return"document"in r&&"onreadystatechange"in r.document.createElement("script")},n.install=function(e){return function(){var t=r.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},r.document.documentElement.appendChild(t),e}}},{}],23:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],24:[function(e,t){"use strict";function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?s[l.call(e)]||"object":typeof e}function r(e){return null!==e&&e===e.window}function o(e){if(!e||"object"!==n(e)||e.nodeType||r(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var o;for(o in e);return void 0===o||p.call(e,o)}function i(e){return"function"===n(e)}function u(){var e,t,n,r,s,c,a=arguments[0]||{},f=1,l=arguments.length,p=!1;for("boolean"==typeof a&&(p=a,a=arguments[1]||{},f=2),"object"==typeof a||i(a)||(a={}),l===f&&(a=this,--f);l>f;f++)if(null!=(e=arguments[f]))for(t in e)if(!(t in Object.prototype)){if(n=a[t],r=e[t],a===r)continue;p&&r&&(o(r)||(s=d(r)))?(s?(s=!1,c=n&&d(n)?n:[]):c=n&&o(n)?n:{},a[t]=u(p,c,r)):void 0!==r&&(d(e)&&i(r)||(a[t]=r))}return a}for(var s={},c=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],a=0;a<c.length;a++){var f=c[a];s["[object "+f+"]"]=f.toLowerCase()}var l=s.toString,p=s.hasOwnProperty,d=Array.isArray||function(e){return"array"===n(e)};t.exports=u},{}],25:[function(e,t,n){var r,o=e("__browserify_process"),i="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};r="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof i.Promise?i.Promise:e("lie"),n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");t=!0,e.apply(this,n)})},n.getArguments=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}},n.toPromise=function(e){return n.getArguments(function(t){var i,u=this,s="function"==typeof t[t.length-1]?t.pop():!1;s&&(i=function(e,t){o.nextTick(function(){s(e,t)})});var c=new r(function(r,o){try{var i=n.once(function(e,t){e?o(e):r(t)});t.push(i),e.apply(u,t)}catch(s){o(s)}});return i&&c.then(function(e){i(null,e)},i),c.cancel=function(){return this},c})},n.inherits=e("inherits"),n.Promise=r,n.extend=e("pouchdb-extend")},{__browserify_process:5,inherits:6,lie:10,"pouchdb-extend":24}]},{},[2]);